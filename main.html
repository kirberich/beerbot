<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<script src="http://code.jquery.com/jquery-2.0.3.min.js"></script>
	<script type="text/javascript">
		var speed = 0,
			direction = 0.5;

		function sendEvent() {
			if (!$("#use-accel").is(':checked')) {
				return;
			}
			console.log("test");
			$.get("/set_speed/" + speed);
			$.get("/set/" + direction);
		}

		window.ondevicemotion = function(event) {
			if (!$("#use-accel").is(':checked')) {
				return;
			}

			var x,y,z;
			x = event.accelerationIncludingGravity.x;
			y = event.accelerationIncludingGravity.y;
			z = event.accelerationIncludingGravity.z;
			$(".accel").html(x + " " + y + " " + z);

			speed = y/10;
			direction = x/20 + 0.5;
		}

		$(function() {
			$("input").change(function() {
				var val = $(this).val();
				if($(this).attr("name") == "steering") {
					if (val == direction) {
						return;
					}
					direction = val;
					var url = "/set/";
					val = val * -1;
					$.get(url+(val));
				} else {
					if (val == speed) {
						return;
					}
					speed = val;
					var url = "/set_speed/";
					$.get(url+val);
				}
			});

			$("body").keydown(function(e) {
				var keyCode = e.which;
				switch(keyCode) {
					case 38:
						$("#speed").val(1).trigger("change");
						break;
					case 40:
						$("#speed").val(-1).trigger("change");
						break;
					case 37:
						$("#steering").val(-1).trigger("change");
						break;
					case 39:
						$("#steering").val(1).trigger("change");
						break;

				}
			});

			$("body").keyup(function(e) {
				var keyCode = e.which;
				if (keyCode == 38 || keyCode == 40) {
					$("#speed").val(0).trigger("change");
				} else if (keyCode == 37 || keyCode == 39) {
					$("#steering").val(0).trigger("change");
				}
			});
		});
		setInterval(sendEvent, 50);
	</script>

	<style type="text/css">
	input[type=range] {
		width: 200px;
		display: block;
	}
	</style>
</head>
<body>
<input type="range" name="speed" id="speed" min="-1", max="1", step="0.05" />
<input type="range" name="steering" id="steering" min="-1", max="1", step="0.05" />
<input type="checkbox" id="use-accel"><label for="use-accel">Use acceleration</label>
<div class="accel"></div>
</body>
</html>
